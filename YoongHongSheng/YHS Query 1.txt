--YHS Query 1
SET LINESIZE 80
SET PAGESIZE 100

ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD';

CREATE OR REPLACE VIEW vw_members_highest_overdue AS
SELECT *
FROM (
SELECT M.MemberID, M.FirstName || ' ' || M.LastName AS FullName, COUNT (LD.Status) AS LateReturned
FROM Member M
JOIN LOAN L ON M.MemberID = L.MemberID
JOIN LOANDETAIL LD ON L.LoanID = LD.LoanID
WHERE M.EndDate >= SYSDATE AND UPPER(LD.Status) = 'LATE RETURNED'
GROUP BY M.MemberID, M.FirstName, M.LastName
ORDER BY LateReturned DESC
)
WHERE ROWNUM <= 10;

TTITLE CENTER '<<TOP 10 MEMBERS WITH HIGHEST OVERDUE BOOK COUNT>>' SKIP 2
REPFOOTER CENTER '<<END OF REPORT>>'

COLUMN MemberID FORMAT A15 HEADING 'Member ID'
COLUMN FullName FORMAT A30 HEADING 'Name'
COLUMN LateReturned FORMAT 999 HEADING 'LATE RETURNED COUNT'

BREAK ON MemberID SKIP 1

SELECT * FROM vw_members_highest_overdue;

CLEAR COLUMNS;
CLEAR BREAKS;
TTITLE OFF;
REPFOOTER OFF;
DROP VIEW vw_members_highest_overdue;